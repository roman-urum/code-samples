<script id="protocolTreeMeasurementBranchTemplate" type="text/template">
    <div class="protocol-item-element protocol-measurement-branch <% if (thresholdAlertSeverityId != null && thresholdAlertSeverityName == null ) { %>invalid<% } %>" data-branchId="<%= id %>">
        <h4>@GlobalStrings.Edit_Customer_CareBuilder_ProtocolsBranchWhenText</h4>
        
        <div class="dropdown element-settings">
            <button class="btn btn-default btn-settings dropdown-toggle" type="button" id="element-settings-<%=id%>" 
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="glyphicon glyphicon-cog"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="element-settings-<%=id%>">
                <li>
                    <a class="js-is-ended js-is-ended-branch <% if ( nextProtocolElementId == null ) { %>protocol-set-continue<% }else{ %>protocol-set-end<% } %>"
                       data-branchId="<%=id%>"
                       data-elementId="<%=elementId%>">
                        <% if ( nextProtocolElementId == null ) { %>Continue Protocol <% }else{ %>End Protocol<% } %>
                    </a>
                </li>
                <li>
                    <a class="js-edit-measurement-branch" data-branchid="<%=id%>">
                        @GlobalStrings.Edit_Customer_CareBuilder_ProtocolsEditBranchLink
                    </a>
                </li>
                <li>
                    <a class="js-delete-measurement-branch" data-branchid="<%=id%>">
                        @GlobalStrings.Edit_Customer_CareBuilder_ProtocolsDeleteBranchLink
                    </a>
                </li>
            </ul>
        </div>
        
        <% if (nextProtocolElementId == null ) { %>
            <span class="element-status glyphicon glyphicon-remove-circle"></span>
        <% } %>
        
        <% if (thresholdAlertSeverityId != null ) { %>
            <div>
                @GlobalStrings.Edit_Customer_CareBuilder_ThresholdSeverityLabel:                 
                <% if (thresholdAlertSeverityName != null ) { %>
                    <%= thresholdAlertSeverityName %>
                <% } else { %>
                    <span class="text-danger">@GlobalStrings.Edit_Customer_CareBuilder_UnknownSeverityLabel</span>
                <% } %>
            </div>
        <% } %>
        
        <% _.each(thresholds.toJSON(), function(threshold) { %>
            <% if (threshold.value == 'High' || threshold.value == 'Low') { %>
                <div>
                    <%= threshold.name %>: <%= threshold.value %>
                </div>
            <% } %>
        
            <% if (threshold.value == 'WithinLimit') { %>
                <div>
                    <%= threshold.name %>: @GlobalStrings.Edit_Customer_CareBuilder_MeasurementThresholdWithinLimitValue
                </div>
            <% } %>
        <% }) %>
    </div>
    <ol class="protocol-list"></ol>
</script>